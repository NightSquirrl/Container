/**

- 压缩PNG图片
- @param {File|Blob} file - 原始图片文件
- @param {Object} options - 压缩选项
- @param {number} options.quality - 压缩质量 (0-1)，默认0.8
- @param {number} options.maxWidth - 最大宽度，默认不限制
- @param {number} options.maxHeight - 最大高度，默认不限制
- @param {string} options.outputFormat - 输出格式 ‘image/png’ 或 ‘image/jpeg’，默认’image/png’
- @returns {Promise<Blob>} 压缩后的图片Blob
  */
  async function compressPNG(file, options = {}) {
  const {
  quality = 0.8,
  maxWidth = null,
  maxHeight = null,
  outputFormat = 'image/png'
  } = options;

return new Promise((resolve, reject) => {
// 创建FileReader读取图片
const reader = new FileReader();


reader.onload = (e) => {
  const img = new Image();
  
  img.onload = () => {
    // 计算压缩后的尺寸
    let { width, height } = img;
    
    if (maxWidth && width > maxWidth) {
      height = (maxWidth / width) * height;
      width = maxWidth;
    }
    
    if (maxHeight && height > maxHeight) {
      width = (maxHeight / height) * width;
      height = maxHeight;
    }
    
    // 创建Canvas
    const canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    
    const ctx = canvas.getContext('2d');
    
    // 绘制图片到Canvas
    ctx.drawImage(img, 0, 0, width, height);
    
    // 转换为Blob
    canvas.toBlob(
      (blob) => {
        if (blob) {
          resolve(blob);
        } else {
          reject(new Error('图片压缩失败'));
        }
      },
      outputFormat,
      quality
    );
  };
  
  img.onerror = () => {
    reject(new Error('图片加载失败'));
  };
  
  img.src = e.target.result;
};

reader.onerror = () => {
  reject(new Error('文件读取失败'));
};

reader.readAsDataURL(file);

});
}


// 导出函数
export { compressPNG };
